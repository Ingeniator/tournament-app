{
  "rules": {
    "tournaments": {
      ".read": "auth != null",
      "$tournamentId": {
        ".read": true,
        ".write": "auth != null && (!data.exists() || data.child('organizerId').val() === auth.uid || root.child('users').child(auth.uid).child('telegramUsername').exists() && root.child('users').child(auth.uid).child('telegramUsername').val() === root.child('users').child(data.child('organizerId').val()).child('telegramUsername').val())",
        "players": {
          "$playerId": {
            ".write": "auth != null && ($playerId === auth.uid || !newData.exists() && data.child('telegramUsername').exists() && data.child('telegramUsername').val() === root.child('users').child(auth.uid).child('telegramUsername').val())",
            ".validate": "newData.hasChildren(['name', 'timestamp']) && newData.child('name').isString() && newData.child('name').val().length < 30 && newData.child('timestamp').isNumber() && (!newData.hasChild('confirmed') || newData.child('confirmed').isBoolean()) && (!newData.hasChild('telegramUsername') || newData.child('telegramUsername').isString() && newData.child('telegramUsername').val().length < 50)"
          }
        },
        "startedBy": {
          ".write": "auth != null",
          ".validate": "newData.hasChildren(['uid', 'name', 'timestamp']) && newData.child('uid').isString() && newData.child('name').isString() && newData.child('timestamp').isNumber()"
        },
        "completedAt": {
          ".write": "auth != null",
          ".validate": "newData.isNumber()"
        }
      }
    },
    "codes": {
      "$code": {
        ".read": true,
        ".write": "auth != null && (!data.exists() || !newData.exists() && root.child('tournaments').child(data.val()).child('organizerId').val() === auth.uid)"
      }
    },
    "supporters": {
      ".read": true,
      "$id": {
        ".write": "auth != null && !data.exists()",
        ".validate": "newData.hasChildren(['name', 'amount', 'timestamp']) && newData.child('name').isString() && newData.child('name').val().length >= 1 && newData.child('name').val().length <= 50 && newData.child('amount').isNumber() && (newData.child('amount').val() === 0 || newData.child('amount').val() === 3 || newData.child('amount').val() === 5 || newData.child('amount').val() === 10) && newData.child('timestamp').isNumber() && (!newData.hasChild('message') || newData.child('message').isString() && newData.child('message').val().length <= 50)"
      }
    },
    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        "name": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid === $uid",
          ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 50"
        },
        "organized": {
          "$tournamentId": {
            ".write": "auth != null && (auth.uid === $uid || !newData.exists() && root.child('users').child(auth.uid).child('telegramUsername').exists() && root.child('users').child(auth.uid).child('telegramUsername').val() === root.child('users').child($uid).child('telegramUsername').val())",
            ".validate": "newData.isBoolean() || !newData.exists()"
          }
        },
        "registrations": {
          "$tournamentId": {
            ".write": "auth != null && (auth.uid === $uid || !newData.exists() && root.child('tournaments').child($tournamentId).child('organizerId').val() === auth.uid || !newData.exists() && root.child('users').child(auth.uid).child('telegramUsername').exists() && root.child('users').child(auth.uid).child('telegramUsername').val() === root.child('users').child($uid).child('telegramUsername').val())",
            ".validate": "newData.isBoolean() || !newData.exists()"
          }
        },
        "telegramId": {
          ".write": "auth != null && auth.uid === $uid",
          ".validate": "newData.isNumber()"
        },
        "telegramUsername": {
          ".write": "auth != null && auth.uid === $uid",
          ".validate": "newData.isString() && newData.val().length < 50"
        }
      }
    },
    "feedback": {
      ".read": false,
      "$id": {
        ".write": "!data.exists()",
        ".validate": "newData.hasChildren(['message', 'source', 'createdAt']) && newData.child('message').isString() && newData.child('message').val().length >= 1 && newData.child('message').val().length <= 500 && newData.child('source').isString() && (newData.child('source').val() === 'runner' || newData.child('source').val() === 'planner') && newData.child('createdAt').isNumber()"
      }
    },
    "telegramUsers": {
      "$username": {
        ".read": "auth != null",
        "currentUid": {
          ".write": "auth != null",
          ".validate": "newData.isString() && newData.val().length < 128"
        },
        "registrations": {
          "$tournamentId": {
            ".write": "auth != null",
            ".validate": "newData.isBoolean() || !newData.exists()"
          }
        },
        "organized": {
          "$tournamentId": {
            ".write": "auth != null",
            ".validate": "newData.isBoolean() || !newData.exists()"
          }
        }
      }
    }
  }
}
